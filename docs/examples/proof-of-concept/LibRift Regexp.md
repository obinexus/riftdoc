# Regular Expression Automaton States in LibRift
## 1. Formal Definition

Let $\mathcal{A}$ be a finite automaton defined as a 5-tuple:

$\mathcal{A} = (Q, \Sigma, \delta, q_0, F)$

where:
- $Q$ is a finite set of states represented by regular expressions
- $\Sigma$ is the input alphabet
- $\delta : Q \times \Sigma \to Q$ is the transition function
- $q_0 \in Q$ is the initial state
- $F \subseteq Q$ is the set of accepting states

### 1.1 Regular Expression State Representation

Each state $q \in Q$ is represented by a regular expression $r_q$ such that:

$r_q \in \mathcal{R}(\Sigma)$ where $\mathcal{R}(\Sigma)$ is the set of all regular expressions over $\Sigma$

For example:
- Initial state: $r_{q_0} = \text{/^/}$ (start of input)
- Final state: $r_f = \text{/\$/}$ (end of input)
- Token state: $r_t = \text{/[A-Z0-9]+/}$ (alphanumeric sequence)

### 1.2 State Transitions

A transition $\delta(q_1, \alpha) = q_2$ is valid if:
1. $\alpha$ matches $r_{q_1}$
2. The remaining input after consuming $\alpha$ can potentially match $r_{q_2}$

Formally:
$\forall \alpha \in \Sigma^*, q_1,q_2 \in Q: \delta(q_1, \alpha) = q_2 \iff \alpha \in L(r_{q_1}) \land \exists \beta \in \Sigma^*: \beta \in L(r_{q_2})$

### 1.3 Language-Agnostic Properties

The key to LibRift's language agnosticism is that any language's tokens can be described as a combination of regular expression states. The automaton becomes a meta-parser where:

1. States represent token patterns rather than specific language constructs
2. Transitions model the valid sequences of these patterns
3. The IR is generated from the sequence of state transitions

## 2. IR Generation

The intermediate representation is generated by mapping state sequences to IR nodes:

Let $\Phi$ be the IR generation function:
$\Phi: Q^* \to \text{IR}$

For a sequence of states $s = (q_1, q_2, ..., q_n)$:
$\Phi(s) = \text{combine}(\phi(q_1), \phi(q_2), ..., \phi(q_n))$

where $\phi: Q \to \text{IR}$ maps individual states to IR components.

## 3. Composition Rules

For states $q_1, q_2 \in Q$, their composition $q_1 \circ q_2$ is valid if:
$\exists w \in \Sigma^*: w \text{ matches } r_{q_1}r_{q_2}$

This ensures that state transitions maintain syntactic validity while remaining language-independent.